# CORS

## CORS란?

- Cross-Origin Resource Sharing
- 서로 다른 프로토콜, 도메인, 포트 등이 자원을 공유하는 것을 뜻합니다.
  1. 프로토콜
     - http와 https는 프로토콜이 다르다.
  2. 도메인
     - domain.com과 other-domain.com은 다르다.
  3. 포트 번호
     - 8080포트와 3000포트는 다르다.

<br>

## 왜 필요한가요?

CORS가 없이 모든 곳에서 데이터를 요청할 수 있게 되면, 다른 사이트에서 원래 사이트를 흉내낼 수 있게 됩니다.  
예를 들어서 기존 사이트와 완전히 동일하게 동작하도록 하여 사용자가 로그인을 하도록 만들고,  
로그인했던 세션을 탈취하여 악의적으로 정보를 추출하거나 다른 사람의 정보를 입력하는 등 공격을 할 수 있습니다.  
이렇게 공격을 할 수 없도록 브라우저에서 보호하고, 필요한 경우 에만 서버와 협의하여 요청할 수 있도록 하기 위해서 필요합니다.

<br>

## 어떻게 동작하나요?

- Simple Request
  1. 서버로 요청을 합니다.
  2. 서버의 응답이 왔을 때 브라우저가 요청한 `Origin`과 응답한 헤더 `Access-Control-Request-Headers`의 값을 비교하여 유효한 요청이라면 리소스를 응답합니다. 만약 유효하지 않은 요청이라면 브라우저에서 이를 막고 에러가 발생합니다.
- preflight
  1. `Origin`헤더에 현재 요청하는 origin과, `Access-Control-Request-Method`헤더에 요청하는 HTTP method와 `Access-Control-Request-Headers`요청 시 사용할 헤더를 `OPTIONS` 메서드로 서버로 요청합니다. 이때 내용물은 없이 헤더만 전송합니다.
  2. 브라우저가 서버에서 응답한 헤더를 보고 유효한 요청인지 확인합니다. 만약 유효하지 않은 요청이라면 요청은 중단되고 에러가 발생합니다. 만약 유효한 요청이라면 원래 요청으로 보내려던 요청을 다시 요청하여 리소스를 응답받습니다.
